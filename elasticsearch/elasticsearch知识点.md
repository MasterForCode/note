---
title: elasticsearch
tags: elasticesearch
time: 2019.1.6
---
1. 存储结构
* Elasticsearch是文件存储，是面向文档型数据库，一条数据在这里就是一个文档，用JSON作为文档序列化格式
* 类比数据库索引（index对应数据库）=》类型（type对应表）=》文档（document对应行）=》字段（fields对应列）
2. 9200端口和9300端口
* 9200是Elasticsearch为restful查询提供的端口
* 9300是Elasticsearch节点间通讯的端口
3. 倒排索引
	通过分词将将关键字和文档进行映射
	

	|  序号   | 文档内容    |
	| --- | --- |
	|  1   |  我是开发人员   |
	|   2   |   我是运维人员  |

	倒排索引会对以上文档内容进行关键字分词，可以使关键字直接定位到文档

	|  单词ID   |  单词   |  倒排列表   |
	| --- | --- | --- |
	|  1   |  我   |  1，2   |
	|   2  |   开发  |  1   |
	|   3  |   运维  |  2   |

4. 类型映射
* 静态映射
  不指定类型由Elasticsearch自动识别
* 动态映射
  指定数据类型
* String类型分为text和keyword，keyword不进行分词处理，只能精确查询

5. 分片
* Shards分片：代表索引分片，是主分片（primary），默认创建5个分片，es可以把一个完整的索引分成多个分片，这样的好处是可以把一个大的索引拆分成多个，分布到不同的节点上，构成分布式搜索。主分片的数量只能在索引创建时指定，并且索引创建后不能更改，每个主分片都有一个副分片。
* 主分片设置后不能修改是因为在查找分片时使用了shard=hash(routing（文档id）)%主分片数算法，如果主分片数改变则可能找不到分片
  ```bash
  # kibana中查询分片设置
  GET /myindex/_settings
  ```
* Replicas分片：代表索引副本，数量一般为节点的平方，es可以设置多个索引副本，副本的作用一是提高系统的容错性，当某个节点某个分片损坏或者丢失时可以从副本中恢复，二是提高es的查询效率，es会自动对搜索请求进行负载均衡
* 主分片和副分片（相同的索引副本）不能在同一节点上（索引副本不同时可以同时存在），单台服务器没有副分片。

6. Elasticsearch客户端
  * Transport
    > &emsp;&emsp;Transport是连接到Elasticsearch的本地方法之一。它是官方Elasticsearch分发的一部分，因此需要客户端用Java编写（或至少在JVM上运行）。 它非常快，在JVM上本机运行。序列化是有效的，发送到/从Elasticsearch实例的消息和操作中几乎没有开销。它需要保持Elasticsearch服务器和客户端版本有些同步。在Elasticsearch 1.0之前，将需要完全相同的版本，但较新的版本（1.0和更高版本）支持版本之间的交互。由于异常序列化和更新之间的其他潜在细微差异，在客户端和服务器上运行相同的JVM更新版本也是有益的。 目前不支持加密或身份验证，但是宣布不久会满足这些需求。要在Found.no托管集群上使用传输客户端，可以使用elasticsearch自定义传输模块，该模块负责加密，身份验证和保持活动。
